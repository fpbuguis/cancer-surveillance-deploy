import{Q,d as m,l as z,s as f,T as Z,p as G,o as d,e as y,b as g,u as i,w as R,F as S,m as l,Z as H,a as s,c as x,f as J,h as K,q,A as P,t as I,n as X,g as Y,k as ee}from"./app-42536e63.js";import{_ as $}from"./InputError-d893a523.js";import{_ as te}from"./PrimaryButton-cd95b478.js";import ae from"./Layout-1c104a2a.js";import"./index-189aeacd.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import"./DropdownLink-ed97a0d6.js";/* empty css                                                               */const oe={class:"lab-list"},re={class:"mt-1 mb-2 ml-5 grid grid-cols-1"},ne=["value"],le={class:"ml-2"},ie={class:"mt-1 mb-2 ml-5 grid grid-cols-1"},ce={key:0,class:"inline-flex items-center"},de=["value"],ue={class:"ml-2"},pe={class:"flex items-center justify-center mt-4"},me={__name:"LaboratoryRequestPage",setup(be){const{props:_}=Q(),E=_.auth.user.user_id,U=_.auth.user.lastname,h=_.auth.user.email,u=m(null),v=m({}),L=m(null),c=m([]),b=m([]),T=async()=>{try{const t=await l.get("/api/find-patient",{params:{lastname:U,email:h}});u.value=t.data.patient_id}catch(t){console.log("Failed to fetch patient ID:",t)}},B=async()=>{try{let t=await l.get(`/api/disease/${u.value}/profile`);v.value=t.data,console.log("Disease Profile:",v.value),L.value=v.value.disease_primarySite}catch(t){console.error("Failed to fetch patient disease profile:",t)}},F=async()=>{try{const t=await l.get(`/api/labMonitors/primary-site/${L.value}`);c.value=t.data,console.log("Laboratories: ",c.value)}catch(t){console.error("Error fetching laboratories:",t)}},M=async()=>{try{const t=await l.get(`/api/patients/${u.value}/labs-submitted`);b.value=t.data,console.log("Submitted Laboratories: ",b.value)}catch(t){console.error("Error fetching submitted laboratories:",t)}};z(async()=>{await T(),await B(),await F(),await M()});const C=t=>{const e=b.value.filter(n=>n.workup_id===t);return e.length===0?null:e.sort((n,r)=>new Date(r.labSubmission_date)-new Date(n.labSubmission_date))[0].labSubmission_date},N=(t,e)=>{const a=new Date,n=new Date(t),r=new Date(n);return r.setMonth(r.getMonth()+e),a<=r},O=f(()=>!c.value.length||!b.value.length?c.value:c.value.filter(t=>{const e=C(t.workup.workup_id);if(!e)return!0;const a=t.workup_frequency;return a?!N(e,a):!1})),o=Z({selectedLaboratory:"",selectedReferral:""}),w=f(()=>{const t=c.value.find(e=>e.workup.workup_name===o.selectedLaboratory);return t?t.workup_referral:null});G(()=>o.selectedLaboratory,()=>{o.selectedReferral=""});const V=async t=>{try{let e=await l.get(`/api/latestonboards/${t}`);return console.log(e.data.doctor_id),e.data.doctor_id}catch(e){console.error("Failed to fetch doctor:",e)}},j=async()=>{var t,e;try{const a=await l.post("/api/create-lab-download",{patient_id:u.value,workup_id:o.selectedLaboratory},{responseType:"blob"}),n=new Blob([a.data],{type:"application/pdf"}),r=URL.createObjectURL(n),p=document.createElement("a");p.href=r,p.download="lab_results.pdf",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(r);let W=await V(u.value);const D=await l.get(`/api/get-doctor/${W}`),A=await l.get(`/api/workupById/${o.selectedLaboratory}`);await l.post("/api/create-notification-log",{from:h,to:D.data.user.email,subject:"Document Requested",message:`The document ${A.data.workup_name} is requested`,senderId:E,receiverId:D.data.user.user_id,notificationStatus:1,notificationType:3}),alert("Document requested!"),o.reset()}catch(a){console.error("Error submitting lab results:",a),alert(`Failed to submit form: ${((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||a.message}`)}},k=f(()=>o.selectedLaboratory!=="");return f(()=>o.selectedReferral!==""),(t,e)=>(d(),y(S,null,[g(i(H),{title:"Laboratory Request"}),g(ae,null,{default:R(()=>[e[7]||(e[7]=s("div",{class:"page-heading"},[s("h1",{class:"main-heading"},"REQUEST DOCUMENTS")],-1)),s("form",{onSubmit:ee(j,["prevent"]),class:"form-container",style:{width:"700px"}},[s("div",null,[s("div",oe,[e[4]||(e[4]=s("h2",null,"Laboratory:",-1)),k.value?J("",!0):(d(),x($,{key:0,message:"Please select one."})),s("div",re,[(d(!0),y(S,null,K(O.value,(a,n)=>(d(),y("label",{key:n,class:"inline-flex items-center"},[q(s("input",{type:"radio",value:a.workup.workup_id,"onUpdate:modelValue":e[0]||(e[0]=r=>i(o).selectedLaboratory=r),class:"form-radio"},null,8,ne),[[P,i(o).selectedLaboratory]]),e[2]||(e[2]=s("span",{class:"custom-radio"},null,-1)),s("span",le,I(a.workup.workup_name),1)]))),128))]),e[5]||(e[5]=s("h2",null,"Referral:",-1)),s("div",ie,[w.value?(d(),y("label",ce,[q(s("input",{type:"radio",value:w.value,"onUpdate:modelValue":e[1]||(e[1]=a=>i(o).selectedReferral=a),class:"form-radio"},null,8,de),[[P,i(o).selectedReferral]]),e[3]||(e[3]=s("span",{class:"custom-radio"},null,-1)),s("span",ue,I(w.value),1)])):(d(),x($,{key:1,message:"There is no referral available for this laboratory."}))])]),s("div",pe,[g(te,{class:X(["ms-4",{"opacity-25":i(o).processing}]),disabled:i(o).processing||!k.value,type:"submit"},{default:R(()=>e[6]||(e[6]=[Y(" DOWNLOAD ")])),_:1},8,["class","disabled"])])])],32)]),_:1})],64))}},ke=se(me,[["__scopeId","data-v-d1506aea"]]);export{ke as default};
