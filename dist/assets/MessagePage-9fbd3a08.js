import{d as i,Q as Y,p as Z,l as z,o as c,e as v,b as g,u as I,w as $,F as x,m as r,Z as H,a as u,q as _,v as E,h as U,t as D,B as k,C as q,f as C,g as J,k as K,c as X}from"./app-42536e63.js";import{_ as F}from"./InputLabel-ff26f500.js";import{_ as ee}from"./PrimaryButton-cd95b478.js";import te from"./Layout-1c104a2a.js";import{A as ae}from"./Alert-e9943a8b.js";import{d as se}from"./index-189aeacd.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import"./DropdownLink-ed97a0d6.js";/* empty css                                                               */const le={class:"form-group"},ue=["disabled"],ie=["value"],re=["disabled"],ne={class:"form-group"},ce=["disabled"],de=["value"],ve={key:0,class:"form-group"},me=["disabled"],fe={class:"form-group"},pe={class:"flex items-center justify-center"},ge={__name:"MessagePage",setup(he){const a=i({to:"",subject:"",message:""}),{url:T,props:y}=Y(),M=y.auth.user.email;let b=y.auth.user.user_id;const L=y.auth.user.role_id,h=new URLSearchParams(window.location.search).get("notifLogId"),l=i(null),o=i(null),m=i({show:!1,message:"",type:""}),O=T.split("/");O[O.length-1];const w=i([]);let d=i(""),n=i("");const P=i(["Cancer Diagnosis","Treatment Follow-up","Checkup Schedule","Patient Outcome","Data Collection"]),B=async s=>{try{let e=await r.get(`/api/doctor-profile/${s}`);o.value=e.data}catch(e){console.error(`Failed to fetch doctor with userId ${s}:`,e)}},N=async s=>{try{let e=await r.get(`/api/doctors/${s}/patients`);w.value=e.data}catch(e){console.error("Failed to fetch patients:",e)}},A=async s=>{try{let e=await r.get("/api/all-doctors");w.value=e.data}catch(e){console.error("Failed to fetch patients:",e)}},R=async s=>{try{let e=await r.get(`/api/get-user/${s}`);o.value=e.data}catch(e){console.error(`Failed to fetch user with userId ${s}:`,e)}};Z(()=>a.value.to,()=>{d.value=""});function f(s){return s?s.split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" "):""}let S=y.auth.user.user_id;i(null),i(0),i(null);const j=i(""),G=()=>{var e;const s=w.value.find(t=>t.user.user_id===a.value.to);j.value=((e=s==null?void 0:s.user)==null?void 0:e.email)||""},Q=async()=>{try{let s=await r.get(`/api/notifications/${h}`);l.value=s.data,console.log(l.value),a.value.to=l.value.notification_sender,console.log(l.value.notification_subject),P.value.includes(l.value.notification_subject)?a.value.subject=l.value.notification_subject:(a.value.subject="Others",n.value=l.value.notification_subject,console.log(l.value.notification_subject))}catch(s){console.error(`Failed to fetch doctor with userId ${S}:`,s)}},W=async()=>{var s,e,t;m.value.show=!1;try{if(l.value&&(j.value=l.value.sender.email),L===2){if(await r.post("/api/send-email",{doctor:"Dr. "+f((s=o==null?void 0:o.value.user_details)==null?void 0:s.firstname)+" "+f((e=o==null?void 0:o.value.user_details)==null?void 0:e.lastname),hospital:(t=o==null?void 0:o.value.hospital_details)==null?void 0:t.hospital_name,from:M,to:a.value.to==="others"?d.value:j.value,subject:a.value.subject==="Others"?n.value:a.value.subject,message:a.value.message,senderId:S,receiverId:a.value.to,notificationStatus:1,notificationType:4}),l.value){const p=await r.put(`api/notification/${b}/update-status`,{notifLog_id:h,status:3})}}else if(await r.post("/api/send-email",{patient:f(o==null?void 0:o.value.firstname)+" "+f(o==null?void 0:o.value.lastname),from:M,to:a.value.to==="others"?d.value:j.value,subject:a.value.subject==="Others"?n.value:a.value.subject,message:a.value.message,senderId:S,receiverId:a.value.to,notificationStatus:1,notificationType:4}),l.value){const p=await r.put(`api/notification/${b}/update-status`,{notifLog_id:h,status:3})}m.value={show:!0,message:"Success! Your email was sent successfully.",type:"success"},se.Inertia.visit("/message")}catch(p){console.error("Failed to send email:",p),m.value={show:!0,message:"Failed to send email. Please ensure you are logged in.",type:"error"}}a.value.to="",a.value.subject="",a.value.message=""};return z(async()=>{L===2?(await B(b),await N(o==null?void 0:o.value.doctor_id)):(await R(b),await A()),h&&await Q(),console.log(n.value),console.log(h)}),(s,e)=>(c(),v(x,null,[g(I(H),{title:"Message"}),g(te,null,{default:$(()=>[e[10]||(e[10]=u("div",{class:"page-heading"},[u("h1",{class:"main-heading"},"MESSAGE")],-1)),u("form",{onSubmit:K(W,["prevent"]),class:"form-container"},[u("div",le,[g(F,{for:"to",value:"To:"}),_(u("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.to=t),onChange:G,class:"input-field",required:"",disabled:l.value},[e[5]||(e[5]=u("option",{disabled:"",value:""},"Select an email",-1)),(c(!0),v(x,null,U(w.value,t=>{var p,V;return c(),v("option",{key:t.id,value:t.user.user_id},D(f((p=t==null?void 0:t.user)==null?void 0:p.firstname)+" "+f((V=t==null?void 0:t.user)==null?void 0:V.lastname)),9,ie)}),128)),e[6]||(e[6]=u("option",{value:"others"},"Others",-1))],40,ue),[[E,a.value.to]]),a.value.to==="others"?_((c(),v("input",{key:0,type:"email","onUpdate:modelValue":e[1]||(e[1]=t=>q(d)?d.value=t:d=t),placeholder:"Please Specify",class:"form-group",required:"",disabled:l.value},null,8,re)),[[k,I(d)]]):C("",!0)]),u("div",ne,[g(F,{for:"subject",value:"Subject:"}),_(u("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.subject=t),class:"input-field",required:"",disabled:l.value},[e[7]||(e[7]=u("option",{disabled:"",value:""},"Select a subject",-1)),(c(!0),v(x,null,U(P.value,t=>(c(),v("option",{key:t,value:t},D(t),9,de))),128)),e[8]||(e[8]=u("option",{value:"Others"},"Others",-1))],8,ce),[[E,a.value.subject]]),a.value.subject==="Others"?(c(),v("div",ve,[_(u("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=t=>q(n)?n.value=t:n=t),class:"input-field",placeholder:"Please specify",required:"",disabled:l.value},null,8,me),[[k,I(n)]])])):C("",!0)]),u("div",fe,[g(F,{for:"message",value:"Message:"}),_(u("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.message=t),class:"message-textarea",required:""},null,512),[[k,a.value.message]])]),u("div",pe,[g(ee,{class:"ms-4"},{default:$(()=>e[9]||(e[9]=[J(" Send ")])),_:1})])],32),m.value.show?(c(),X(ae,{key:0,message:m.value.message,type:m.value.type},null,8,["message","type"])):C("",!0)]),_:1})],64))}},Fe=oe(ge,[["__scopeId","data-v-81d3f4c7"]]);export{Fe as default};
