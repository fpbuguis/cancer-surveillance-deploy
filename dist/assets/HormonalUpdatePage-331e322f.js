import{Q as A,d as v,T,l as E,m as _,o as g,c as I,w as h,a as s,b as l,g as y,u as t,q as H,v as L,t as V,e as b,h as F,F as M,f as D,k as B}from"./app-42536e63.js";import{_ as r}from"./InputError-d893a523.js";import{_ as m}from"./InputLabel-ff26f500.js";import{_ as p}from"./TextInput-d9580142.js";import{_ as R}from"./PrimaryButton-cd95b478.js";import{A as j}from"./Alert-e9943a8b.js";import q from"./Layout-1c104a2a.js";import{d as Q}from"./index-189aeacd.js";import{_ as z}from"./_plugin-vue_export-helper-c27b6911.js";import"./DropdownLink-ed97a0d6.js";/* empty css                                                               */const G=["disabled"],J={value:"",disabled:"",selected:""},K=["value"],W={key:0,class:"mt-2 text-sm text-red-600"},X={class:"flex items-center justify-center mt-4"},Y={__name:"HormonalUpdatePage",setup(Z){const{url:w,props:k}=A(),c=w.split("/");let d=c[c.length-1];d=parseInt(d,10),console.log("Patient ID:",d);let i;c.length===4&&(i=parseInt(c[2],10),d=parseInt(c[3],10));const S=k.auth.user.user_id,$=k.auth.user.email,f=v({show:!1,message:"",type:""}),o=T({lastname:"",email:"",hormonal_drugs:"",hormonal_dose:"",hormonal_initial_date:"",hormonal_end_date:"",hormonal_status:"",hormonal_notes:"",hormonal_doctor:""}),x=v(0),U=v([]),N=v(0);if(w){const n=new URL(w,window.location.origin);x.value=n.searchParams.get("currentStep")}else console.error("URL is undefined");const C=async()=>{try{const a=(await _.get("/api/all-patients")).data.find(u=>u.patient_id===d);if(console.log("Found patient:",a),a){const u=a.user;o.lastname=u.lastname,o.email=u.email}}catch(n){console.error("Failed to fetch patient info:",n)}},O=async n=>{try{const a=(await _.get(`/api/patient/${n}/treatments`)).data;console.log(a),o.hormonal_drugs=a.hormonals[i].hormonal_drugs,o.hormonal_dose=a.hormonals[i].hormonal_dose,o.hormonal_initial_date=a.hormonals[i].hormonal_initial_date,o.hormonal_end_date=a.hormonals[i].hormonal_end_date,o.hormonal_status=a.hormonals[i].hormonal_status,o.hormonal_notes=a.hormonals[i].hormonal_notes,o.hormonal_doctor=a.hormonals[i].hormonal_doctor}catch(e){console.error("Failed to fetch patient:",e)}};E(async()=>{await C(),await O(d),_.get("/api/all-doctors").then(n=>{U.value=n.data}).catch(n=>{console.error(n)})});const P=async()=>{try{f.value.show=!1,console.log(o);const n=await _.put(`/api/treatment/update/hormonal/${d}`,o),e=await _.get(`/api/get-patient/${d}`);await _.post("/api/create-notification-log",{from:$,to:e.data.user.email,subject:"Treatment Information Updated",message:"The patient's HORMONAL treatment is updated",senderId:S,receiverId:e.data.user.user_id,notificationStatus:1,notificationType:5}),n.status===200?(f.value={show:!0,message:"Success! Hormonal therapy details updated.",type:"success"},Q.Inertia.get("/search")):console.error("Error updating details:",n.status)}catch(n){console.error("Error updating details:",n)}};return(n,e)=>(g(),I(q,null,{default:h(()=>[e[15]||(e[15]=s("div",{class:"page-heading"},[s("h1",{class:"main-heading"},"HORMONAL")],-1)),s("form",{onSubmit:B(P,["prevent"]),class:"form-container"},[s("div",null,[l(m,{for:"lastname"},{default:h(()=>e[10]||(e[10]=[y(" Last Name "),s("span",{class:"red-asterisk"},"*",-1)])),_:1}),l(p,{id:"lastname",modelValue:t(o).lastname,"onUpdate:modelValue":e[0]||(e[0]=a=>t(o).lastname=a),type:"text",class:"mt-1 block w-full",autofocus:"",autocomplete:"lastname",disabled:""},null,8,["modelValue"]),l(r,{class:"mt-2",message:t(o).errors.lastname},null,8,["message"])]),s("div",null,[l(m,{for:"email"},{default:h(()=>e[11]||(e[11]=[y(" Email Address "),s("span",{class:"red-asterisk"},"*",-1)])),_:1}),l(p,{id:"email",modelValue:t(o).email,"onUpdate:modelValue":e[1]||(e[1]=a=>t(o).email=a),type:"email",class:"mt-1 block w-full",autocomplete:"username",disabled:""},null,8,["modelValue"]),l(r,{class:"mt-2",message:t(o).errors.email},null,8,["message"])]),s("div",null,[l(m,{for:"hormonal_drugs",value:"Hormonal Drug"}),l(p,{id:"hormonal_drugs",modelValue:t(o).hormonal_drugs,"onUpdate:modelValue":e[2]||(e[2]=a=>t(o).hormonal_drugs=a),type:"text",class:"mt-1 block w-full"},null,8,["modelValue"]),l(r,{message:t(o).errors.hormonal_drugs},null,8,["message"])]),s("div",null,[l(m,{for:"hormonal_dose",value:"Hormonal Dose"}),l(p,{id:"hormonal_dose",modelValue:t(o).hormonal_dose,"onUpdate:modelValue":e[3]||(e[3]=a=>t(o).hormonal_dose=a),type:"text",class:"mt-1 block w-full"},null,8,["modelValue"]),l(r,{class:"mt-2",message:t(o).errors.hormonal_dose},null,8,["message"])]),s("div",null,[l(m,{for:"hormonal_initial_date",value:"Initial Hormonal Date"}),l(p,{id:"hormonal_initial_date",modelValue:t(o).hormonal_initial_date,"onUpdate:modelValue":e[4]||(e[4]=a=>t(o).hormonal_initial_date=a),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),l(r,{class:"mt-2",message:t(o).errors.hormonal_initial_date},null,8,["message"])]),s("div",null,[l(m,{for:"hormonal_end_date",value:"Last Hormonal Date"}),l(p,{id:"hormonal_end_date",modelValue:t(o).hormonal_end_date,"onUpdate:modelValue":e[5]||(e[5]=a=>t(o).hormonal_end_date=a),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),l(r,{class:"mt-2",message:t(o).errors.hormonal_end_date},null,8,["message"])]),s("div",null,[l(m,{for:"hormonal_status",value:"Hormonal Status"}),H(s("select",{id:"hormonal_status","onUpdate:modelValue":e[6]||(e[6]=a=>t(o).hormonal_status=a),class:"mt-1 block w-full"},e[12]||(e[12]=[s("option",{value:"",disabled:""},"Select Hormonal Status",-1),s("option",{value:"Ongoing"},"Ongoing",-1),s("option",{value:"Completed"},"Completed",-1),s("option",{value:"Not Completed"},"Not Completed",-1)]),512),[[L,t(o).hormonal_status]]),l(r,{class:"mt-2",message:t(o).errors.hormonal_status},null,8,["message"])]),s("div",null,[l(m,{for:"hormonal_notes",value:"Hormonal Notes"}),l(p,{id:"hormonal_notes",modelValue:t(o).hormonal_notes,"onUpdate:modelValue":e[7]||(e[7]=a=>t(o).hormonal_notes=a),type:"text",class:"mt-1 block w-full"},null,8,["modelValue"]),l(r,{class:"mt-2",message:t(o).errors.hormonal_notes},null,8,["message"])]),s("div",null,[l(m,{for:"hormonal_doctor"},{default:h(()=>e[13]||(e[13]=[y(" Hormonal Doctor ")])),_:1}),H(s("select",{id:"hormonal_doctor","onUpdate:modelValue":e[8]||(e[8]=a=>t(o).hormonal_doctor=a),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:"",disabled:n.isLoading},[s("option",J,V(n.isLoading?"Loading doctors...":"Select a Doctor"),1),(g(!0),b(M,null,F(U.value,a=>(g(),b("option",{key:a.doctor_id,value:a.doctor_id},V("Dr. "+`${a.user.firstname} ${a.user.middlename} ${a.user.lastname}`.toLowerCase().split(" ").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(" ")),9,K))),128))],8,G),[[L,t(o).hormonal_doctor]]),l(r,{class:"mt-2",message:t(o).errors.hormonal_doctor},null,8,["message"]),n.error?(g(),b("p",W,V(n.error),1)):D("",!0)]),s("div",X,[l(R,{onClick:e[9]||(e[9]=a=>N.value=1),class:"ms-4"},{default:h(()=>e[14]||(e[14]=[y(" Update Details ")])),_:1})])],32),f.value.show?(g(),I(j,{key:0,message:f.value.message,type:f.value.type},null,8,["message","type"])):D("",!0)]),_:1}))}},ue=z(Y,[["__scopeId","data-v-75b6599a"]]);export{ue as default};
