import{Q as N,d as f,T as j,l as q,m as g,o as d,c as C,w as _,a as r,b as l,g as b,u as a,q as y,A as U,e as c,B as G,f as S,v as L,t as k,h as R,F as D,k as Y}from"./app-42536e63.js";import{_ as m}from"./InputError-d893a523.js";import{_ as u}from"./InputLabel-ff26f500.js";import{_ as V}from"./TextInput-d9580142.js";import H from"./Layout-1c104a2a.js";import{A as Q}from"./Alert-e9943a8b.js";import{_ as z}from"./PrimaryButton-cd95b478.js";import{d as J}from"./index-189aeacd.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import"./DropdownLink-ed97a0d6.js";/* empty css                                                               */const W={class:"mt-1 flex flex-col gap-2"},X={class:"inline-flex items-center"},Z={class:"inline-flex items-center mt-1"},ee={class:"inline-flex items-center mt-1"},se={class:"inline-flex items-center mt-1"},te={key:0,class:"mt-3"},re=["disabled"],ae={value:"",disabled:"",selected:""},le=["value"],oe={key:0,class:"mt-2 text-sm text-red-600"},ne=["value"],ie={class:"flex items-center justify-center mt-4"},ue={__name:"SurgeryUpdatePage",setup(de){const{url:I,props:x}=N(),v=I.split("/");let n=v[v.length-1];n=parseInt(n,10),console.log("Patient ID:",n);let i;v.length===4&&(i=parseInt(v[2],10),n=parseInt(v[3],10));const E=x.auth.user.user_id,T=x.auth.user.email,w=f({show:!1,message:"",type:""}),t=j({lastname:"",email:"",surgery_operation:"",surgery_date:"",surgery_findings:"",surgery_intent:"",surgery_otherIntent:"",surgery_surgeon:"",surgery_hospital:""}),F=f(0),h=f([]),$=f([]),P=f(null),O=f(0);if(I){const o=new URL(I,window.location.origin);F.value=o.searchParams.get("currentStep")}else console.error("URL is undefined");const A=async()=>{try{const s=(await g.get("/api/all-patients")).data.find(p=>p.patient_id===n);if(console.log("Found patient:",s),s){const p=s.user;t.lastname=p.lastname,t.email=p.email}}catch(o){console.error("Failed to fetch patient info:",o)}},B=async o=>{try{const s=(await g.get(`/api/patient/${o}/treatments`)).data;console.log(s),t.surgery_operation=s.surgeries[i].surgery_operation,t.surgery_date=s.surgeries[i].surgery_date,t.surgery_findings=s.surgeries[i].surgery_findings,t.surgery_intent=s.surgeries[i].surgery_intent,t.surgery_intent==="Others"&&(t.surgery_otherIntent=s.treatments[i].surgery_otherIntent),t.surgery_surgeon=s.surgeries[i].surgery_surgeon,t.surgery_hospital=s.surgeries[i].surgery_hospital}catch(e){console.error("Failed to fetch patient:",e)}};q(async()=>{await A(),await B(n),console.log(n),console.log(i);try{const[o,e]=await Promise.all([g.get("/api/all-doctors"),g.get("/api/hospitals")]);h.value=o.data,$.value=e.data}catch(o){console.error("Error loading initial data:",o)}});const M=async()=>{try{w.value.show=!1,console.log(t);const o=await g.put(`/api/treatment/update/surgery/${n}`,t),e=await g.get(`/api/get-patient/${n}`);await g.post("/api/create-notification-log",{from:T,to:e.data.user.email,subject:"Treatment Information Updated",message:"The patient's SURGERY treatment is updated",senderId:E,receiverId:e.data.user.user_id,notificationStatus:1,notificationType:5}),o.status===200?(w.value={show:!0,message:"Success! Treatment surgery details updated.",type:"success"},J.Inertia.get("/search")):console.error("Error updating details:",o.status)}catch(o){console.error("Error updating details:",o)}};return(o,e)=>(d(),C(H,null,{default:_(()=>[e[27]||(e[27]=r("div",{class:"page-heading"},[r("h1",{class:"main-heading"},"SURGERY")],-1)),r("form",{onSubmit:Y(M,["prevent"]),class:"form-container"},[r("div",null,[l(u,{for:"lastname"},{default:_(()=>e[13]||(e[13]=[b(" Last Name "),r("span",{class:"red-asterisk"},"*",-1)])),_:1}),l(V,{id:"lastname",modelValue:a(t).lastname,"onUpdate:modelValue":e[0]||(e[0]=s=>a(t).lastname=s),type:"text",class:"mt-1 block w-full",autofocus:"",autocomplete:"lastname",disabled:""},null,8,["modelValue"]),l(m,{class:"mt-2",message:a(t).errors.lastname},null,8,["message"])]),r("div",null,[l(u,{for:"email"},{default:_(()=>e[14]||(e[14]=[b(" Email Address "),r("span",{class:"red-asterisk"},"*",-1)])),_:1}),l(V,{id:"email",modelValue:a(t).email,"onUpdate:modelValue":e[1]||(e[1]=s=>a(t).email=s),type:"email",class:"mt-1 block w-full",autocomplete:"username",disabled:""},null,8,["modelValue"]),l(m,{class:"mt-2",message:a(t).errors.email},null,8,["message"])]),r("div",null,[l(u,{for:"surgery_operation",value:"Surgery Operation"}),l(V,{id:"surgery_operation",modelValue:a(t).surgery_operation,"onUpdate:modelValue":e[2]||(e[2]=s=>a(t).surgery_operation=s),type:"text",class:"mt-1 block w-full"},null,8,["modelValue"]),l(m,{message:a(t).errors.surgery_operation},null,8,["message"])]),r("div",null,[l(u,{for:"surgery_date",value:"Surgery Date"}),l(V,{id:"surgery_date",modelValue:a(t).surgery_date,"onUpdate:modelValue":e[3]||(e[3]=s=>a(t).surgery_date=s),type:"date",class:"mt-1 block w-full"},null,8,["modelValue"]),l(m,{class:"mt-2",message:a(t).errors.surgery_date},null,8,["message"])]),r("div",null,[l(u,{for:"surgery_findings",value:"Surgery Findings"}),l(V,{id:"surgery_findings",modelValue:a(t).surgery_findings,"onUpdate:modelValue":e[4]||(e[4]=s=>a(t).surgery_findings=s),type:"text",class:"mt-1 block w-full"},null,8,["modelValue"]),l(m,{class:"mt-2",message:a(t).errors.surgery_findings},null,8,["message"])]),r("div",null,[l(u,{for:"surgery_intent",value:"Surgery Intent"}),r("div",W,[r("label",X,[y(r("input",{type:"radio",name:"treatment_purpose",value:"Curative-complete","onUpdate:modelValue":e[5]||(e[5]=s=>a(t).surgery_intent=s),class:"form-radio"},null,512),[[U,a(t).surgery_intent]]),e[15]||(e[15]=r("span",{class:"custom-radio"},null,-1)),e[16]||(e[16]=r("span",{class:"ml-2"},"Curative-complete",-1))]),r("label",Z,[y(r("input",{type:"radio",name:"treatment_purpose",value:"Curative-incomplete","onUpdate:modelValue":e[6]||(e[6]=s=>a(t).surgery_intent=s),class:"form-radio"},null,512),[[U,a(t).surgery_intent]]),e[17]||(e[17]=r("span",{class:"custom-radio"},null,-1)),e[18]||(e[18]=r("span",{class:"ml-2"},"Curative-incomplete",-1))]),r("label",ee,[y(r("input",{type:"radio",name:"treatment_purpose",value:"Palliative only","onUpdate:modelValue":e[7]||(e[7]=s=>a(t).surgery_intent=s),class:"form-radio"},null,512),[[U,a(t).surgery_intent]]),e[19]||(e[19]=r("span",{class:"custom-radio"},null,-1)),e[20]||(e[20]=r("span",{class:"ml-2"},"Palliative only",-1))]),r("label",se,[y(r("input",{type:"radio",name:"treatment_purpose",value:"Others","onUpdate:modelValue":e[8]||(e[8]=s=>a(t).surgery_intent=s),class:"form-radio"},null,512),[[U,a(t).surgery_intent]]),e[21]||(e[21]=r("span",{class:"custom-radio"},null,-1)),e[22]||(e[22]=r("span",{class:"ml-2"},"Others",-1))])]),a(t).surgery_intent==="Others"?(d(),c("div",te,[l(u,{for:"surgery_otherIntent",value:"Specify"}),y(r("input",{id:"surgery_otherIntent","onUpdate:modelValue":e[9]||(e[9]=s=>a(t).surgery_otherIntent=s),type:"text",class:"mt-1 block w-full",placeholder:"Specify surgery intent"},null,512),[[G,a(t).surgery_otherIntent]])])):S("",!0),l(m,{class:"mt-2",message:a(t).errors.treatment_purpose},null,8,["message"])]),r("div",null,[l(u,{for:"surgery_surgeon"},{default:_(()=>e[23]||(e[23]=[b(" Surgery Doctor "),r("span",{class:"red-asterisk"},"*",-1)])),_:1}),y(r("select",{id:"surgery_surgeon","onUpdate:modelValue":e[10]||(e[10]=s=>a(t).surgery_surgeon=s),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500",required:"",disabled:o.isLoading},[r("option",ae,k(o.isLoading?"Loading doctors...":"Select a Doctor"),1),(d(!0),c(D,null,R(h.value,s=>(d(),c("option",{key:s.doctor_id,value:s.doctor_id},k("Dr. "+`${s.user.firstname} ${s.user.middlename} ${s.user.lastname}`.toLowerCase().split(" ").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" ")),9,le))),128))],8,re),[[L,a(t).surgery_surgeon]]),l(m,{class:"mt-2",message:a(t).errors.surgery_surgeon},null,8,["message"]),P.value?(d(),c("p",oe,k(P.value),1)):S("",!0)]),r("div",null,[l(u,{for:"surgery_hospital"},{default:_(()=>e[24]||(e[24]=[b(" Surgery Hospital "),r("span",{class:"red-asterisk"},"*",-1)])),_:1}),y(r("select",{id:"surgery_hospital","onUpdate:modelValue":e[11]||(e[11]=s=>a(t).surgery_hospital=s),class:"mt-1 block w-full",required:""},[e[25]||(e[25]=r("option",{value:"",disabled:""},"Select hospital",-1)),(d(!0),c(D,null,R($.value,s=>(d(),c("option",{key:s.hospital_id,value:s.hospital_id},k(s.hospital_name),9,ne))),128))],512),[[L,a(t).surgery_hospital]]),l(m,{class:"mt-2",message:a(t).errors.surgery_hospital},null,8,["message"])]),r("div",ie,[l(z,{onClick:e[12]||(e[12]=s=>O.value=1),class:"ms-4"},{default:_(()=>e[26]||(e[26]=[b(" Update Details ")])),_:1})])],32),w.value.show?(d(),C(Q,{key:0,message:w.value.message,type:w.value.type},null,8,["message","type"])):S("",!0)]),_:1}))}},Ue=K(ue,[["__scopeId","data-v-b66e139f"]]);export{Ue as default};
