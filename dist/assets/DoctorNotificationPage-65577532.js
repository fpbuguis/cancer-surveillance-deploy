import H from"./Layout-1c104a2a.js";import{B as J,s as R,a as _}from"./column.esm-e576acfe.js";import{s as Q}from"./dialog.esm-b66c5bf0.js";import"./vuecal-f418645a.js";import{d as I}from"./index-189aeacd.js";import{Q as q,d as y,s as $,l as Y,o as b,e as w,b as u,u as l,w as r,F as Z,Z as z,a as e,g as i,t as a,f as S,c as M}from"./app-42536e63.js";import{_ as E}from"./PrimaryButton-cd95b478.js";import{_ as K}from"./_plugin-vue_export-helper-c27b6911.js";import"./DropdownLink-ed97a0d6.js";/* empty css                                                               */var W={root:function(m){m.instance;var d=m.props;return["p-listbox p-component",{"p-disabled":d.disabled,"p-invalid":d.invalid}]},header:"p-listbox-header",filterContainer:"p-listbox-filter-container",filterInput:"p-listbox-filter p-inputtext p-component",filterIcon:"p-listbox-filter-icon",wrapper:"p-listbox-list-wrapper",list:"p-listbox-list",itemGroup:"p-listbox-item-group",item:function(m){var d=m.instance,f=m.option,v=m.index,p=m.getItemOptions;return["p-listbox-item",{"p-highlight":d.isSelected(f),"p-focus":d.focusedOptionIndex===d.getOptionIndex(v,p),"p-disabled":d.isOptionDisabled(f)}]},emptyMessage:"p-listbox-empty-message"};J.extend({name:"listbox",classes:W});const X={class:"table-section"},h={class:"table-container"},tt={class:"system-message"},et={style:{"font-weight":"bold"}},ot={style:{"font-weight":"bold"}},st={class:"table-container"},nt={key:0,class:"popup"},it={key:0},at={key:1},lt=["src"],rt={style:{display:"flex","justify-content":"center","align-items":"center"}},ut={class:"flex items-center justify-center mt-4"},dt="http://127.0.0.1:8000/storage/",pt={__name:"DoctorNotificationPage",setup(P){const{url:m,props:d}=q(),f=d.auth.user.user_id;d.auth.user.role_id;const v=y(null),p=y(null),L=y(null),O=async s=>{try{let t=await axios.get(`/api/doctor-profile/${s}`);L.value=t.data,console.log("Doctor: ",L.value)}catch(t){console.error(`Failed to fetch doctor with userId ${s}:`,t)}},F=async s=>{try{let t=await axios.get(`/api/notifications/receiver/${s}`);v.value=t.data.filter(o=>o.notification_type.notifType_id!==2&&o.notification_type.notifType_id!==1),p.value=t.data.filter(o=>o.notification_type.notifType_id==1||o.notification_type.notifType_id==2),console.log("Symptom Surveys & Lab Submissions: ",p.value),v.value=v.value.filter(o=>{var g;return((g=o.notification_status)==null?void 0:g.notifStatus_name)!=="Action Taken"}),p.value=p.value.filter(o=>{var g;return((g=o.notification_status)==null?void 0:g.notifStatus_name)!=="Action Taken"})}catch(t){console.error("Failed to fetch messages:",t)}},k=y(!1),n=y(null),x=y(null),D=async(s,t)=>{s.notification_status.notifStatus_name==="Unread"&&(console.log(s),await axios.put(`api/notification/${t}/update-status`,{notifLog_id:s.notifLog_id,status:2}),s.notification_status.notifStatus_name="Viewed"),x.value=s.notifLog_id,n.value=s,n.value.labSubmitted_id!=null&&C(n.value.labs_submitted.labFileSubmissions),k.value=!0},j=()=>{I.Inertia.visit(`/message?notifLogId=${x.value}`)},A=async()=>{const s=await axios.put(`api/notification/${f}/update-status`,{notifLog_id:x.value,status:3});console.log(s.data),I.Inertia.visit("/doctornotification")},T=s=>s.notification_status.notifStatus_name==="Unread"?"unread-message":"viewed-message",B=$(()=>p.value?p.value.length:0),U=$(()=>v.value!==null?v.value.filter(t=>{var o;return((o=t.notification_status)==null?void 0:o.notifStatus_name)==="Unread"}).length:0);y("");const c=y(null),C=s=>{const t=JSON.parse(s)[0];c.value=`${dt}${t}`,console.log(c.value)},V=()=>{c.value&&window.open(c.value,"_blank")},G=s=>{console.log(s);const t=document.createElement("a");t.href=c.value,t.download=`${s.sender.lastname}_${s.labs_submitted.workup.workup_name}`,t.click()};return Y(async()=>{await O(f),await F(f),console.log(n),C()}),(s,t)=>(b(),w(Z,null,[u(l(z),{title:"Notification"}),u(H,null,{default:r(()=>[t[27]||(t[27]=e("div",{class:"page-heading"},[e("h1",{class:"main-heading"}," ALERTS ")],-1)),e("div",X,[e("div",h,[t[4]||(t[4]=e("div",{class:"title-div"},[e("h2",{class:"table-title"},"MESSAGES")],-1)),u(l(R),{value:v.value,responsiveLayout:"scroll",onRowClick:t[0]||(t[0]=o=>D(o.data,l(f))),rowHover:"",rowClass:T,paginator:!0,rows:3,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[3,5,10,25]},{default:r(()=>[u(l(_),{field:"date",header:"Date"},{body:r(o=>[i(a(o.data.notification_date),1)]),_:1}),u(l(_),{field:"sender",header:"Sender"},{body:r(o=>[i(a(o.data.sender.firstname+" "+o.data.sender.lastname),1)]),_:1}),u(l(_),{field:"subject",header:"Subject"},{body:r(o=>[i(a(o.data.notification_subject),1)]),_:1})]),_:1},8,["value"])]),e("div",tt,[t[7]||(t[7]=e("strong",null,"SYSTEM MESSAGE:",-1)),e("p",null,[t[5]||(t[5]=i("Number of unread messages: ")),e("span",et,a(U.value),1)]),e("p",null,[t[6]||(t[6]=i("Number of patient submissions: ")),e("span",ot,a(B.value),1)])]),e("div",st,[t[8]||(t[8]=e("div",{class:"title-div"},[e("h2",{class:"table-title"},"PATIENT SUBMISSION")],-1)),u(l(R),{value:p.value,responsiveLayout:"scroll",onRowClick:t[1]||(t[1]=o=>D(o.data,l(f))),rowHover:"",rowClass:T,paginator:!0,rows:3,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[3,5,10,25]},{default:r(()=>[u(l(_),{field:"date",header:"Date"},{body:r(o=>[i(a(o.data.notification_date),1)]),_:1}),u(l(_),{field:"patient",header:"Patient"},{body:r(o=>[i(a(o.data.sender.firstname+" "+o.data.sender.lastname),1)]),_:1}),u(l(_),{field:"documentType",header:"Document Type"},{body:r(o=>{var g,N;return[i(a(((N=(g=o.data.labs_submitted)==null?void 0:g.workup)==null?void 0:N.workup_name)||o.data.notification_subject),1)]}),_:1})]),_:1},8,["value"])])]),u(l(Q),{visible:k.value,"onUpdate:visible":t[3]||(t[3]=o=>k.value=o),header:"Details",closable:!0,modal:!0,width:"400px"},{default:r(()=>[n.value?(b(),w("div",nt,[e("p",null,[t[9]||(t[9]=e("strong",null,"Date:",-1)),i(" "+a(n.value.notification_date),1)]),e("p",null,[t[10]||(t[10]=e("strong",null,"Sender:",-1)),i(" "+a(n.value.sender.firstname+" "+n.value.sender.lastname),1)]),e("p",null,[t[11]||(t[11]=e("strong",null,"Subject:",-1)),i(" "+a(n.value.notification_subject),1)]),e("p",null,[t[12]||(t[12]=e("strong",null,"Message:",-1)),i(" "+a(n.value.notification_notes),1)]),n.value.surveyResponse_id!=null?(b(),w("div",it,[t[19]||(t[19]=e("br",null,null,-1)),t[20]||(t[20]=e("hr",null,null,-1)),t[21]||(t[21]=e("br",null,null,-1)),e("p",null,[t[13]||(t[13]=e("strong",null,"Completed Treatment/s:",-1)),i(" "+a(n.value.surveyResponse.treatment_completion),1)]),e("p",null,[t[14]||(t[14]=e("strong",null,"Local Symptom:",-1)),i(" "+a(n.value.surveyResponse.symptom_surveys[0].symptom_name),1)]),e("p",null,[t[15]||(t[15]=e("strong",null,"Systemic Symptom:",-1)),i(" "+a(n.value.surveyResponse.symptom_surveys[1].symptom_name),1)]),e("p",null,[t[16]||(t[16]=e("strong",null,"Quality of Life:",-1)),i(" "+a(n.value.surveyResponse.symptom_surveys[2].symptom_name),1)]),e("p",null,[t[17]||(t[17]=e("strong",null,"Treatment Side Effects:",-1)),i(" "+a(n.value.surveyResponse.symptom_surveys[3].symptom_name),1)]),e("p",null,[t[18]||(t[18]=e("strong",null,"Additional notes:",-1)),i(" "+a(n.value.surveyResponse.response_notes),1)])])):S("",!0),n.value.labSubmitted_id!=null?(b(),w("div",at,[t[22]||(t[22]=e("br",null,null,-1)),t[23]||(t[23]=e("hr",null,null,-1)),t[24]||(t[24]=e("br",null,null,-1)),e("div",null,[c.value?(b(),w("iframe",{key:0,src:c.value,width:"100%",height:"600"},null,8,lt)):S("",!0),e("div",rt,[e("button",{onClick:V,class:"btn"},"Open PDF in New Tab"),e("button",{onClick:t[2]||(t[2]=o=>G(n.value)),class:"btn"},"Download PDF")])])])):S("",!0),e("div",ut,[n.value.notification_type.notifType_id===4?(b(),M(E,{key:0,onClick:j},{default:r(()=>t[25]||(t[25]=[i("Reply")])),_:1})):(b(),M(E,{key:1,onClick:A},{default:r(()=>t[26]||(t[26]=[i("Done")])),_:1}))])])):S("",!0)]),_:1},8,["visible"])]),_:1})],64))}},kt=K(pt,[["__scopeId","data-v-4d1d75e7"]]);export{kt as default};
